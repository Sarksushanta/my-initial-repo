Final solution for the critical bug